// Add this at the top to fix IMU or remove IMU line
//#include <Adafruit_LSM9DS1.h>
//Adafruit_LSM9DS1 IMU = Adafruit_LSM9DS1();
//sensors_event_t Omagn, Ogyro, Oaccel;

void setup() {
  scanner.Init();
  Serial.begin(9600);
  Wire.begin();

  Serial1.begin(1200, SERIAL_7E1);
  pinMode(DIRO, OUTPUT);
  digitalWrite(DIRO, HIGH);

  pinMode(buttonPin, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(buttonPin), triggerSensorBundle, FALLING);

  // Buttons Setup
  pinMode(3, INPUT_PULLUP);
  pinMode(4, INPUT_PULLUP);

  if (!rtc.begin()) {
    Serial.println("RTC NOT CONNECTED");
    SetUpErrorFlag = true;
  }

  if (!bme.begin()) {
    Serial.println("BME680 not found!");
    SetUpErrorFlag = true;
  }

  bme.setTemperatureOversampling(BME680_OS_8X);
  bme.setHumidityOversampling(BME680_OS_2X);
  bme.setPressureOversampling(BME680_OS_4X);
  bme.setGasHeater(320, 150);

  if (!lightMeter.begin(BH1750::CONTINUOUS_HIGH_RES_MODE)) {
    Serial.println("BH1750 not found!");
    SetUpErrorFlag = true;
  }

  while (SetUpErrorFlag) {
    Serial.println("Setup Error");
    delay(1000);
    scanner.Scan();
  }
}

void loop() {
  // remove or define IMU properly
  //IMU.getAllData(&Omagn, &Ogyro, &Oaccel);

  if (ButtonPressed(1)) {
    Serial.println("You pressed button 1");
    SDI12send("abc");
  }
  if (ButtonPressed(2)) {
    Serial.println("You pressed button 2");
    Serial.println(SDI12receive());
  }
}
